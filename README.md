# QuickTrans - æœ¬åœ°éŸ³é¢‘ç¿»è¯‘ä¸æ–‡æœ¬ç¿»è¯‘è½¯ä»¶

> æç®€éƒ¨ç½² Â· çº¯æœ¬åœ°è¿è¡Œ Â· é«˜æ€§èƒ½è¯†åˆ« Â· å®Œå…¨ç¦»çº¿

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. éŸ³é¢‘è½¬å½•ï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰
- âœ… æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼ˆMP3, WAV, M4A, FLACï¼‰
- âœ… è‡ªåŠ¨è¯­è¨€è¯†åˆ«
- âœ… é«˜ç²¾åº¦è¯­éŸ³è¯†åˆ«ï¼ˆåŸºäº Whisperï¼‰
- âœ… æœ¬åœ°å¤„ç†ï¼Œä¿æŠ¤éšç§

### 2. å¤šè¯­è¨€æ–‡æœ¬ç¿»è¯‘ï¼ˆç¦»çº¿ï¼‰â­ æ–°å¢
- âœ… ä¸­è‹±æ—¥éŸ©æ³•å¾·è¥¿å¤šè¯­è¨€äº’è¯‘
- âœ… å®Œå…¨ç¦»çº¿è¿è¡Œï¼Œæ— éœ€è”ç½‘
- âœ… åŸºäº MarianMT æ¨¡å‹
- âœ… æ”¯æŒæ‰¹é‡ç¿»è¯‘

### 3. ç¹ç®€è½¬æ¢
- âœ… ä¸­æ–‡ç®€ç¹äº’è½¬
- âœ… åŸºäº OpenCC

---

## 1. é¡¹ç›®æ„¿æ™¯ä¸å•†ä¸šä»·å€¼

### 1.1 å¸‚åœºç—›ç‚¹

å½“å‰å¸‚åœºä¸Šçš„éŸ³é¢‘ç¿»è¯‘å·¥å…·å­˜åœ¨ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

- **éšç§é£é™©**ï¼šäº‘æœåŠ¡éœ€è¦ä¸Šä¼ éŸ³é¢‘ï¼Œå•†ä¸šæœºå¯†ã€ä¼šè®®è®°å½•ç­‰æ•æ„Ÿæ•°æ®é¢ä¸´æ³„éœ²é£é™©
- **ç½‘ç»œä¾èµ–**ï¼šå¿…é¡»åœ¨çº¿ä½¿ç”¨ï¼Œç½‘ç»œæ³¢åŠ¨ç›´æ¥å½±å“è¯†åˆ«æ•ˆæœå’Œæ•ˆç‡
- **é«˜æ˜‚æˆæœ¬**ï¼šä¸»æµ SaaS æœåŠ¡é‡‡ç”¨è®¢é˜…åˆ¶ï¼Œé•¿æœŸä½¿ç”¨æˆæœ¬é«˜æ˜‚ï¼ˆå¦‚ AWS Transcribe $0.024/åˆ†é’Ÿï¼‰
- **éƒ¨ç½²å¤æ‚**ï¼šå¼€æºæ–¹æ¡ˆï¼ˆå¦‚ Whisperï¼‰éœ€è¦é…ç½® Python ç¯å¢ƒã€ä¸‹è½½æ¨¡å‹ï¼Œå¯¹éæŠ€æœ¯äººå‘˜é—¨æ§›æé«˜

### 1.2 QuickTrans æ ¸å¿ƒä»·å€¼

**ã€ŒåŒå‡»å³ç”¨çš„æœ¬åœ° AI ç¿»è¯‘å·¥ä½œç«™ã€**

| ç»´åº¦ | ä¼ ç»Ÿæ–¹æ¡ˆ | QuickTrans |
|------|----------|------------|
| **éšç§å®‰å…¨** | äº‘ç«¯å¤„ç†ï¼Œæ•°æ®ä¸Šä¼ é£é™© | 100% æœ¬åœ°å¤„ç†ï¼Œæ•°æ®é›¶å‡ºå¢ƒ |
| **éƒ¨ç½²æˆæœ¬** | éœ€é…ç½® Python/PyTorch ç¯å¢ƒ | å•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒå‡»å³ç”¨ |
| **ä½¿ç”¨æˆæœ¬** | $50-200/å¹´è®¢é˜…è´¹ | ä¸€æ¬¡æ€§ä¹°æ–­ / å¼€æºå…è´¹ |
| **æ€§èƒ½è¡¨ç°** | å—ç½‘ç»œå»¶è¿Ÿå½±å“ | æœ¬åœ° GPU åŠ é€Ÿï¼Œå®æ—¶å“åº” |
| **é€‚ç”¨åœºæ™¯** | ä»…åœ¨çº¿ç¯å¢ƒ | é£è¡Œã€ä¿å¯†åœºæ‰€çš†å¯ç”¨ |

### 1.3 å•†ä¸šåŒ–è·¯å¾„

**ç›®æ ‡ç”¨æˆ·ç¾¤ä½“**ï¼š
- **å†…å®¹åˆ›ä½œè€…**ï¼šYouTuberã€æ’­å®¢ä¸»æ’­éœ€è¦å¿«é€Ÿç”Ÿæˆå­—å¹•
- **ä¼ä¸šç”¨æˆ·**ï¼šè·¨å›½ä¼šè®®è®°å½•ã€åŸ¹è®­ææ–™æœ¬åœ°åŒ–
- **æ•™è‚²æœºæ„**ï¼šå…¬å¼€è¯¾ç¿»è¯‘ã€å­¦æœ¯ä¼šè®®è½¬å½•
- **æ”¿åºœ/å†›å·¥**ï¼šæ¶‰å¯†åœºæ™¯ï¼Œå¼ºåˆ¶è¦æ±‚æœ¬åœ°åŒ–éƒ¨ç½²

**å•†ä¸šæ¨¡å¼å»ºè®®**ï¼š
1. **ä¸ªäººç‰ˆï¼ˆ$49 ä¸€æ¬¡æ€§ï¼‰**ï¼šæ”¯æŒå•è¯­ç§ç¿»è¯‘ï¼ŒåŸºç¡€æ¨¡å‹
2. **ä¸“ä¸šç‰ˆï¼ˆ$199 ä¸€æ¬¡æ€§ï¼‰**ï¼šå¤šè¯­ç§ã€å¤§æ¨¡å‹ã€æ‰¹é‡å¤„ç†
3. **ä¼ä¸šç‰ˆï¼ˆ$999/å¹´ï¼‰**ï¼šç§æœ‰åŒ–éƒ¨ç½²ã€å®šåˆ¶è®­ç»ƒã€æŠ€æœ¯æ”¯æŒ
4. **å¼€æºå…è´¹ç‰ˆ**ï¼šåŸºç¡€åŠŸèƒ½ï¼ŒæŠ€æœ¯ç¤¾åŒºæ”¯æŒ

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾ï¼ˆæ›´æ–°ç‰ˆï¼‰

```mermaid
graph TB
    A[ç”¨æˆ·ç•Œé¢ Electron React] --> B[IPC é€šä¿¡]
    B --> C[Python FastAPI åå°è¿›ç¨‹]

    C --> D[Whisper éŸ³é¢‘è½¬å½•å¼•æ“]
    C --> E[MarianMT ç¿»è¯‘å¼•æ“]
    C --> F[OpenCC ç¹ç®€è½¬æ¢]

    D --> G[éŸ³é¢‘ â†’ æ–‡æœ¬]
    E --> H[æ–‡æœ¬ â†’ ç¿»è¯‘]
    F --> I[ç®€ä½“ â†” ç¹ä½“]

    style A fill:#61dafb
    style C fill:#68a063
    style D fill:#ff0003
    style E fill:#ffeb3b
    style F fill:#95e1d3
```

### 2.2 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æŠ€æœ¯æ ˆ | åŠŸèƒ½ | ç¦»çº¿æ”¯æŒ |
|------|--------|------|----------|
| **å‰ç«¯ç•Œé¢** | Electron + React | ç”¨æˆ·äº¤äº’ | âœ… |
| **éŸ³é¢‘è½¬å½•** | Whisper (faster-whisper) | è¯­éŸ³ â†’ æ–‡æœ¬ | âœ… |
| **æ–‡æœ¬ç¿»è¯‘** | MarianMT (transformers) | å¤šè¯­è¨€ç¿»è¯‘ | âœ… |
| **ç¹ç®€è½¬æ¢** | OpenCC | ç®€ç¹äº’è½¬ | âœ… |
| **API æœåŠ¡** | FastAPI + Uvicorn | åç«¯æ¥å£ | âœ… |

### 2.3 ç¿»è¯‘åŠŸèƒ½è®¾è®¡

#### æ”¯æŒçš„è¯­è¨€å¯¹
```
ä¸­æ–‡ (zh) â†’ è‹±æ–‡ (en)
è‹±æ–‡ (en) â†’ ä¸­æ–‡ (zh)ã€æ—¥æ–‡ (ja)ã€éŸ©æ–‡ (ko)ã€æ³•æ–‡ (fr)ã€å¾·æ–‡ (de)ã€è¥¿ç­ç‰™æ–‡ (es)
æ—¥æ–‡ (ja) â†’ è‹±æ–‡ (en)
éŸ©æ–‡ (ko) â†’ è‹±æ–‡ (en)
æ³•æ–‡ (fr) â†’ è‹±æ–‡ (en)
å¾·æ–‡ (de) â†’ è‹±æ–‡ (en)
è¥¿ç­ç‰™æ–‡ (es) â†’ è‹±æ–‡ (en)
```

#### ç¿»è¯‘æ¨¡å‹
- **æ¨¡å‹ç±»å‹ï¼š** MarianMT (Helsinki-NLP/opus-mt ç³»åˆ—)
- **æ¨¡å‹å¤§å°ï¼š** çº¦ 300 MB/è¯­è¨€å¯¹
- **ç¦»çº¿è¿è¡Œï¼š** âœ… å®Œå…¨ç¦»çº¿
- **å…è´¹ä½¿ç”¨ï¼š** âœ… å¼€æºå…è´¹
graph TB
    subgraph "Frontend Layer - Electron Renderer"
        UI[React + Tailwind CSS]
        DropZone[æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ ç»„ä»¶]
        ProgressBar[å®æ—¶è¿›åº¦æ¡]
        ResultView[ç¿»è¯‘ç»“æœå±•ç¤º]
        ExportPanel[å¯¼å‡º SRT/TXT]
    end

    subgraph "Main Process - Electron Main"
        IPC[IPC é€šä¿¡ç®¡ç†å™¨]
        WindowManager[çª—å£ç®¡ç†]
        PythonBridge[Python è¿›ç¨‹æ¡¥æ¥]
        TaskQueue[ä»»åŠ¡é˜Ÿåˆ—è°ƒåº¦]
    end

    subgraph "AI Engine - Python Sidecar"
        HTTPServer[FastAPI HTTP Server]
        AudioExtractor[FFmpeg éŸ³é¢‘æå–]
        WhisperEngine[Faster-Whisper æ¨ç†å¼•æ“]
        Translator[ç¿»è¯‘æ¨¡å—]
        TaskWorker[å¼‚æ­¥ä»»åŠ¡å¤„ç†å™¨]
    end

    subgraph "Storage Layer"
        SQLite[(SQLite Database)]
        ModelFiles[æœ¬åœ°æ¨¡å‹æ–‡ä»¶]
        Cache[éŸ³é¢‘ç¼“å­˜]
    end

    UI -->|IPC| IPC
    IPC --> PythonBridge
    PythonBridge -->|HTTP localhost:5000| HTTPServer
    HTTPServer --> AudioExtractor
    HTTPServer --> WhisperEngine
    HTTPServer --> Translator
    HTTPServer --> TaskWorker
    TaskWorker --> SQLite
    WhisperEngine --> ModelFiles
    AudioExtractor --> Cache

    style UI fill:#61dafb
    style PythonBridge fill:#68a063
    style WhisperEngine fill:#f7df1e
    style SQLite fill:#003b57
```

### 2.2 æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç†ç”± |
|------|----------|------|
| **UI æ¡†æ¶** | Electron + React 18 | æˆç†Ÿç”Ÿæ€ã€è·¨å¹³å°ã€ä¾¿äºæ‰“åŒ… |
| **æ ·å¼æ–¹æ¡ˆ** | Tailwind CSS | å¿«é€Ÿè¿­ä»£ã€è®¾è®¡ç³»ç»Ÿç»Ÿä¸€ |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡çº§ã€æ— æ ·æ¿ä»£ç  |
| **IPC é€šä¿¡** | electron-better-ipc | ç±»å‹å®‰å…¨ã€Promise å°è£… |
| **Python æ¡¥æ¥** | node-pty + sidecar | è¿›ç¨‹ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸå¯æ§ |
| **AI å¼•æ“** | Faster-Whisper | ç›¸æ¯”åŸç‰ˆ 4x é€Ÿåº¦æå‡ã€ä½å†…å­˜ |
| **éŸ³é¢‘å¤„ç†** | FFmpeg (å‘½ä»¤è¡Œ) | å·¥ä¸šæ ‡å‡†ã€æ ¼å¼å…¨æ”¯æŒ |
| **API æ¡†æ¶** | FastAPI | å¼‚æ­¥é«˜æ€§èƒ½ã€è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ |
| **æ•°æ®åº“** | better-sqlite3 | åŒæ­¥ APIã€æ— éœ€é¢å¤–ç¼–è¯‘ |
| **æ‰“åŒ…å·¥å…·** | electron-forge + PyInstaller | ä¸€æ¬¡æ‰“åŒ…ã€æ— éœ€ Python ç¯å¢ƒ |

---

## 3. æ ¸å¿ƒæ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 Electron ä¸»è¿›ç¨‹æ¶æ„

**èŒè´£**ï¼š
- ç®¡ç†çª—å£ç”Ÿå‘½å‘¨æœŸ
- å¯åŠ¨/åœæ­¢ Python å­è¿›ç¨‹
- ä»»åŠ¡é˜Ÿåˆ—è°ƒåº¦ä¸å¹¶å‘æ§åˆ¶
- SQLite æ•°æ®åº“æ“ä½œ

**å…³é”®æ–‡ä»¶**ï¼š
```
src/main/
â”œâ”€â”€ index.ts              # å…¥å£æ–‡ä»¶ï¼Œå¯åŠ¨ Python sidecar
â”œâ”€â”€ python-bridge.ts      # Python è¿›ç¨‹ç®¡ç†å™¨
â”œâ”€â”€ task-scheduler.ts     # ä»»åŠ¡é˜Ÿåˆ—ä¸å¹¶å‘æ§åˆ¶
â”œâ”€â”€ database.ts           # SQLite æ•°æ®åº“å°è£…
â””â”€â”€ ipc-handlers.ts       # IPC äº‹ä»¶å¤„ç†å™¨
```

**Python æ¡¥æ¥æ¨¡å— (src/main/python-ridge.ts)**ï¼š

```typescript
import { spawn, ChildProcess } from 'child_process';
import path from 'path';
import { app } from 'electron';

export class PythonBridge {
  private process: ChildProcess | null = null;
  private readonly port = 5000;
  private readonly pythonPath: string;

  constructor() {
    // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ‰“åŒ…åçš„äºŒè¿›åˆ¶ï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
    this.pythonPath = app.isPackaged
      ? path.join(process.resourcesPath, 'python-engine', 'engine')
      : path.join(__dirname, '../../python-engine/.venv/bin/python');
  }

  async start(): Promise<void> {
    if (this.process) return;

    const scriptPath = app.isPackaged
      ? path.join(process.resourcesPath, 'python-engine', 'main.py')
      : path.join(__dirname, '../../python-engine/main.py');

    this.process = spawn(this.pythonPath, [scriptPath, '--port', String(this.port)], {
      stdio: ['ignore', 'pipe', 'pipe'],
      env: {
        ...process.env,
        PYTHONUNBUFFERED: '1',
        MODEL_PATH: path.join(app.getPath('userData'), 'models'),
      }
    });

    this.process.stderr?.on('data', (data) => {
      console.error(`[Python Error] ${data}`);
    });

    this.process.stdout?.on('data', (data) => {
      console.log(`[Python] ${data}`);
    });

    // ç­‰å¾…æœåŠ¡å°±ç»ª
    await this.waitForReady();
  }

  private async waitForReady(): Promise<void> {
    // è½®è¯¢ HTTP ç«¯ç‚¹ç›´åˆ°æœåŠ¡å°±ç»ª
    const maxAttempts = 30;
    for (let i = 0; i < maxAttempts; i++) {
      try {
        const response = await fetch(`http://localhost:${this.port}/health`);
        if (response.ok) return;
      } catch {
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }
    throw new Error('Python engine failed to start');
  }

  stop(): void {
    if (this.process) {
      this.process.kill('SIGTERM');
      this.process = null;
    }
  }
}
```

### 3.2 Python AI å¼•æ“æ¶æ„

**èŒè´£**ï¼š
- æä¾› HTTP API ä¾› Electron è°ƒç”¨
- FFmpeg éŸ³é¢‘æå–ä¸é¢„å¤„ç†
- Faster-Whisper æ¨ç†
- ç¿»è¯‘ä¸å­—å¹•ç”Ÿæˆ
- è¿›åº¦æ¨é€ï¼ˆSSEï¼‰

**å…³é”®æ–‡ä»¶**ï¼š
```
python-engine/
â”œâ”€â”€ main.py               # FastAPI å…¥å£
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ audio.py          # éŸ³é¢‘å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ whisper.py        # Whisper æ¨ç†å°è£…
â”‚   â””â”€â”€ translator.py     # ç¿»è¯‘æ¨¡å—
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ routes.py         # API è·¯ç”±å®šä¹‰
â”‚   â””â”€â”€ schemas.py        # Pydantic æ•°æ®æ¨¡å‹
â””â”€â”€ utils/
    â”œâ”€â”€ ffmpeg.py         # FFmpeg å°è£…
    â””â”€â”€ progress.py       # è¿›åº¦æ¨é€å·¥å…·
```

**FastAPI ä¸»å…¥å£ (python-engine/main.py)**ï¼š

```python
from fastapi import FastAPI, UploadFile, BackgroundTasks
from fastapi.responses import StreamingResponse
from pydantic import BaseModel
import asyncio

app = FastAPI(title="QuickTrans AI Engine")

class TranscribeRequest(BaseModel):
    file_path: str
    source_lang: str = "auto"
    target_lang: str = "zh"
    model_size: str = "medium"

class ProgressEmitter:
    def __init__(self):
        self._queue = asyncio.Queue()

    async def emit(self, progress: float, message: str):
        await self._queue.put({
            "progress": progress,
            "message": message,
            "timestamp": time.time()
        })

    async def stream(self):
        while True:
            data = await self._queue.get()
            yield f"data: {json.dumps(data)}\n\n"

@app.post("/api/transcribe")
async def start_transcription(
    request: TranscribeRequest,
    background_tasks: BackgroundTasks
):
    emitter = ProgressEmitter()
    task_id = str(uuid.uuid4())

    # å¯åŠ¨åå°ä»»åŠ¡
    background_tasks.add_task(
        run_transcription_pipeline,
        task_id,
        request,
        emitter
    )

    return {
        "task_id": task_id,
        "stream_url": f"/api/tasks/{task_id}/progress"
    }

@app.get("/api/tasks/{task_id}/progress")
async def task_progress(task_id: str):
    return StreamingResponse(
        get_emitter(task_id).stream(),
        media_type="text/event-stream"
    )

async def run_transcription_pipeline(
    task_id: str,
    request: TranscribeRequest,
    emitter: ProgressEmitter
):
    try:
        # 1. éŸ³é¢‘æå– (0-20%)
        await emitter.emit(0.1, "æ­£åœ¨æå–éŸ³é¢‘...")
        audio_path = await extract_audio(request.file_path)

        # 2. Whisper æ¨ç† (20-80%)
        await emitter.emit(0.2, "æ­£åœ¨è¯†åˆ«è¯­éŸ³...")
        segments = await run_whisper(
            audio_path,
            request.source_lang,
            request.model_size,
            lambda p: emitter.emit(0.2 + p * 0.6, f"è¯†åˆ«ä¸­... {int(p*100)}%")
        )

        # 3. ç¿»è¯‘ (80-90%)
        await emitter.emit(0.8, "æ­£åœ¨ç¿»è¯‘...")
        translated = await translate_segments(segments, request.target_lang)

        # 4. ç”Ÿæˆå­—å¹• (90-100%)
        await emitter.emit(0.9, "æ­£åœ¨ç”Ÿæˆå­—å¹•...")
        srt_content = generate_srt(translated)
        save_to_database(task_id, translated, srt_content)

        await emitter.emit(1.0, "å®Œæˆï¼")

    except Exception as e:
        await emitter.emit(-1, f"é”™è¯¯: {str(e)}")
```

**Whisper æ¨ç†å°è£… (python-engine/models/whisper.py)**ï¼š

```python
from faster_whisper import WhisperModel
import torch

class WhisperEngine:
    def __init__(self, model_size: str = "medium", device: str = "auto"):
        if device == "auto":
            device = "cuda" if torch.cuda.is_available() else "cpu"

        self.model = WhisperModel(
            model_size,
            device=device,
            compute_type="float16" if device == "cuda" else "int8",
            num_workers=4,
            download_root=os.getenv("MODEL_PATH")
        )

    async def transcribe(
        self,
        audio_path: str,
        language: str = "auto",
        progress_callback: callable = None
    ) -> list[dict]:
        segments, info = self.model.transcribe(
            audio_path,
            language=language if language != "auto" else None,
            beam_size=5,
            vad_filter=True,
            word_timestamps=True
        )

        results = []
        total_duration = info.duration

        for segment in segments:
            results.append({
                "start": segment.start,
                "end": segment.end,
                "text": segment.text.strip(),
                "confidence": segment.avg_logprob
            })

            if progress_callback:
                progress = segment.end / total_duration
                await progress_callback(progress)

        return results
```

### 3.3 IPC é€šä¿¡åè®®è®¾è®¡

**é€šä¿¡æµç¨‹**ï¼š

```mermaid
sequenceDiagram
    participant UI as Electron Renderer
    participant Main as Electron Main
    participant Py as Python Engine

    UI->>Main: ipc.invoke('transcribe', filePath)
    Main->>Main: åˆ›å»ºä»»åŠ¡è®°å½•åˆ° SQLite
    Main->>Py: POST /api/transcribe
    Py-->>Main: è¿”å› task_id + stream_url
    Main-->>UI: è¿”å› task_id

    loop æ¨é€è¿›åº¦
        Py->>Py: å¤„ç†éŸ³é¢‘/æ¨ç†/ç¿»è¯‘
        Py->>Main: SSE: data: {"progress": 0.5}
        Main->>UI: webContents.send('progress', {taskId, progress})
        UI->>UI: æ›´æ–°è¿›åº¦æ¡
    end

    Py->>Main: SSE: data: {"progress": 1.0, "result": {...}}
    Main->>Main: æ›´æ–°æ•°æ®åº“çŠ¶æ€
    Main->>UI: webContents.send('complete', {taskId, result})
    UI->>UI: æ˜¾ç¤ºç»“æœï¼Œå¯ç”¨å¯¼å‡ºæŒ‰é’®
```

**IPC äº‹ä»¶å®šä¹‰**ï¼š

| äº‹ä»¶æ–¹å‘ | äº‹ä»¶å | å‚æ•° | è¯´æ˜ |
|----------|--------|------|------|
| Renderer â†’ Main | `transcribe:start` | `{ filePath, sourceLang, targetLang }` | å¯åŠ¨è½¬å½•ä»»åŠ¡ |
| Main â†’ Renderer | `transcribe:progress` | `{ taskId, progress, message }` | è¿›åº¦æ¨é€ï¼ˆ0-1ï¼‰ |
| Main â†’ Renderer | `transcribe:complete` | `{ taskId, result }` | ä»»åŠ¡å®Œæˆ |
| Main â†’ Renderer | `transcribe:error` | `{ taskId, error }` | ä»»åŠ¡å¤±è´¥ |
| Renderer â†’ Main | `tasks:history` | `{ limit, offset }` | æŸ¥è¯¢å†å²è®°å½• |
| Renderer â†’ Main | `export:srt` | `{ taskId, savePath }` | å¯¼å‡º SRT æ–‡ä»¶ |

**IPC å¤„ç†å™¨å®ç° (src/main/ipc-handlers.ts)**ï¼š

```typescript
import { ipcMain, webContents } from 'electron';
import { TaskScheduler } from './task-scheduler';
import { Database } from './database';

export function registerIPCHandlers(scheduler: TaskScheduler, db: Database) {
  ipcMain.handle('transcribe:start', async (event, payload) => {
    const { filePath, sourceLang, targetLang } = payload;

    // åˆ›å»ºä»»åŠ¡è®°å½•
    const taskId = await db.createTask({
      filePath,
      sourceLang,
      targetLang,
      status: 'pending',
      createdAt: Date.now()
    });

    // æäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—
    scheduler.addTask({
      taskId,
      filePath,
      sourceLang,
      targetLang,
      onProgress: (progress, message) => {
        event.sender.send('transcribe:progress', { taskId, progress, message });
      },
      onComplete: (result) => {
        db.updateTask(taskId, { status: 'completed', result });
        event.sender.send('transcribe:complete', { taskId, result });
      },
      onError: (error) => {
        db.updateTask(taskId, { status: 'failed', error });
        event.sender.send('transcribe:error', { taskId, error });
      }
    });

    return { taskId };
  });

  ipcMain.handle('tasks:history', async (_, { limit = 20, offset = 0 }) => {
    return db.getTasks({ limit, offset });
  });

  ipcMain.handle('export:srt', async (_, { taskId, savePath }) => {
    const task = await db.getTask(taskId);
    if (!task || task.status !== 'completed') {
      throw new Error('Task not completed');
    }
    await fs.writeFile(savePath, task.result.srt);
    return { success: true };
  });
}
```

### 3.4 è¿›åº¦æ¡ä¸å®æ—¶åé¦ˆ

**å‰ç«¯è¿›åº¦ç»„ä»¶ (src/renderer/components/ProgressBar.tsx)**ï¼š

```typescript
import { useEffect, useState } from 'react';
import { ipcRenderer } from 'electron';

interface TaskProgress {
  taskId: string;
  progress: number;
  message: string;
}

export function TranscriptionProgress({ taskId }: { taskId: string }) {
  const [progress, setProgress] = useState(0);
  const [message, setMessage] = useState('ç­‰å¾…ä¸­...');

  useEffect(() => {
    const handler = (_: any, data: TaskProgress) => {
      if (data.taskId === taskId) {
        setProgress(Math.floor(data.progress * 100));
        setMessage(data.message);
      }
    };

    ipcRenderer.on('transcribe:progress', handler);

    return () => {
      ipcRenderer.removeListener('transcribe:progress', handler);
    };
  }, [taskId]);

  return (
    <div className="w-full">
      <div className="flex justify-between text-sm text-gray-600 mb-2">
        <span>{message}</span>
        <span>{progress}%</span>
      </div>
      <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
        <div
          className="h-full bg-blue-600 transition-all duration-300"
          style={{ width: `${progress}%` }}
        />
      </div>
    </div>
  );
}
```

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 SQLite è¡¨ç»“æ„

**ä»»åŠ¡è¡¨ (tasks)**ï¼š

```sql
CREATE TABLE tasks (
    id TEXT PRIMARY KEY,
    file_path TEXT NOT NULL,
    file_name TEXT NOT NULL,
    duration INTEGER,           -- éŸ³é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    source_lang TEXT NOT NULL,
    target_lang TEXT NOT NULL,
    model_size TEXT DEFAULT 'medium',
    status TEXT NOT NULL,       -- pending/processing/completed/failed
    progress REAL DEFAULT 0,    -- 0.0 - 1.0
    error_message TEXT,
    created_at INTEGER NOT NULL,
    completed_at INTEGER,
    result_json TEXT            -- JSON: { segments: [], srt: "", txt: "" }
);

CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_created ON tasks(created_at DESC);
```

**å­—å¹•ç‰‡æ®µè¡¨ (segments)**ï¼ˆå¯é€‰ï¼Œç”¨äºé«˜çº§æŸ¥è¯¢ï¼‰ï¼š

```sql
CREATE TABLE segments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    task_id TEXT NOT NULL,
    start_time REAL NOT NULL,   -- å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
    end_time REAL NOT NULL,     -- ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
    original_text TEXT NOT NULL,
    translated_text TEXT,
    confidence REAL,
    FOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE
);

CREATE INDEX idx_segments_task ON segments(task_id);
CREATE INDEX idx_segments_time ON segments(start_time, end_time);
```

**é…ç½®è¡¨ (settings)**ï¼š

```sql
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at INTEGER NOT NULL
);

-- åˆå§‹é…ç½®
INSERT INTO settings (key, value, updated_at) VALUES
    ('default_source_lang', 'auto', 0),
    ('default_target_lang', 'zh', 0),
    ('model_size', 'medium', 0),
    ('thread_count', '4', 0),
    ('export_format', 'srt', 0);
```

### 4.2 æ•°æ®åº“å°è£… (src/main/database.ts)

```typescript
import Database from 'better-sqlite3';
import path from 'path';
import { app } from 'electron';

export interface Task {
  id: string;
  filePath: string;
  fileName: string;
  duration?: number;
  sourceLang: string;
  targetLang: string;
  status: 'pending' | 'processing' | 'completed' | 'failed';
  progress: number;
  errorMessage?: string;
  createdAt: number;
  completedAt?: number;
  result?: {
    segments: Array<{
      start: number;
      end: number;
      text: string;
      translation: string;
    }>;
    srt: string;
    txt: string;
  };
}

export class TaskDatabase {
  private db: Database.Database;

  constructor() {
    const dbPath = path.join(app.getPath('userData'), 'quicktrans.db');
    this.db = new Database(dbPath);
    this.initSchema();
  }

  private initSchema() {
    this.db.exec(`
      CREATE TABLE IF NOT EXISTS tasks (
        id TEXT PRIMARY KEY,
        file_path TEXT NOT NULL,
        file_name TEXT NOT NULL,
        duration INTEGER,
        source_lang TEXT NOT NULL,
        target_lang TEXT NOT NULL,
        model_size TEXT DEFAULT 'medium',
        status TEXT NOT NULL,
        progress REAL DEFAULT 0,
        error_message TEXT,
        created_at INTEGER NOT NULL,
        completed_at INTEGER,
        result_json TEXT
      );

      CREATE INDEX IF NOT EXISTS idx_tasks_status ON tasks(status);
      CREATE INDEX IF NOT EXISTS idx_tasks_created ON tasks(created_at DESC);
    `);
  }

  createTask(task: Omit<Task, 'status' | 'progress' | 'createdAt'>): string {
    const id = generateUUID();
    const stmt = this.db.prepare(`
      INSERT INTO tasks (
        id, file_path, file_name, source_lang, target_lang,
        status, progress, created_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    `);

    stmt.run(
      id,
      task.filePath,
      task.fileName,
      task.sourceLang,
      task.targetLang,
      'pending',
      0,
      Date.now()
    );

    return id;
  }

  updateTask(
    id: string,
    updates: Partial<Pick<Task, 'status' | 'progress' | 'errorMessage' | 'completedAt' | 'result'>>
  ) {
    const fields: string[] = [];
    const values: any[] = [];

    if (updates.status !== undefined) {
      fields.push('status = ?');
      values.push(updates.status);
    }
    if (updates.progress !== undefined) {
      fields.push('progress = ?');
      values.push(updates.progress);
    }
    if (updates.errorMessage !== undefined) {
      fields.push('error_message = ?');
      values.push(updates.errorMessage);
    }
    if (updates.completedAt !== undefined) {
      fields.push('completed_at = ?');
      values.push(updates.completedAt);
    }
    if (updates.result !== undefined) {
      fields.push('result_json = ?');
      values.push(JSON.stringify(updates.result));
    }

    values.push(id);

    const stmt = this.db.prepare(`
      UPDATE tasks SET ${fields.join(', ')} WHERE id = ?
    `);

    stmt.run(...values);
  }

  getTask(id: string): Task | null {
    const stmt = this.db.prepare('SELECT * FROM tasks WHERE id = ?');
    const row = stmt.get(id) as any;
    return row ? this.mapRowToTask(row) : null;
  }

  getTasks({ limit = 20, offset = 0 }: { limit?: number; offset?: number } = {}): Task[] {
    const stmt = this.db.prepare(`
      SELECT * FROM tasks ORDER BY created_at DESC LIMIT ? OFFSET ?
    `);
    const rows = stmt.all(limit, offset) as any[];
    return rows.map(row => this.mapRowToTask(row));
  }

  private mapRowToTask(row: any): Task {
    return {
      id: row.id,
      filePath: row.file_path,
      fileName: row.file_name,
      duration: row.duration,
      sourceLang: row.source_lang,
      targetLang: row.target_lang,
      status: row.status,
      progress: row.progress,
      errorMessage: row.error_message,
      createdAt: row.created_at,
      completedAt: row.completed_at,
      result: row.result_json ? JSON.parse(row.result_json) : undefined
    };
  }

  close() {
    this.db.close();
  }
}
```

---

## 5. æ‰“åŒ…ä¸åˆ†å‘æ–¹æ¡ˆ

### 5.1 æ ¸å¿ƒæŒ‘æˆ˜

1. **Python ç¯å¢ƒä¾èµ–**ï¼šç”¨æˆ·ç”µè„‘æ— éœ€å®‰è£… Python
2. **æ¨¡å‹æ–‡ä»¶åˆ†å‘**ï¼šWhisper æ¨¡å‹ï¼ˆ~1GBï¼‰å¦‚ä½•æ‰“åŒ…
3. **è·¨å¹³å°å…¼å®¹**ï¼šWindows/macOS/Linux åˆ†åˆ«å¤„ç†
4. **åº”ç”¨ä½“ç§¯æ§åˆ¶**ï¼šé¿å…æœ€ç»ˆåŒ… > 5GB

### 5.2 æŠ€æœ¯æ–¹æ¡ˆ

#### 5.2.1 Python ç«¯æ‰“åŒ…

**æ–¹æ¡ˆï¼šPyInstaller å•æ–‡ä»¶æ‰“åŒ…**

```bash
# python-engine/build.py
import PyInstaller.__main__
import os

PyInstaller.__main__.run([
    'main.py',
    '--onefile',
    '--name=engine',
    '--add-binary=ffmpeg:.',  # åµŒå…¥ FFmpeg äºŒè¿›åˆ¶
    '--hidden-import=faster_whisper',
    '--hidden-import=ctranslate2',
    '--clean',
    '--noconfirm',
    '--distpath=../dist/python-engine',
])
```

**æ‰“åŒ…åæ–‡ä»¶ç»“æ„**ï¼š
```
dist/
â”œâ”€â”€ QuickTrans-win-x64.exe           # Electron ä¸»ç¨‹åº
â””â”€â”€ resources/
    â””â”€â”€ python-engine/
        â”œâ”€â”€ engine.exe                # Python å¼•æ“å•æ–‡ä»¶
        â””â”€â”€ models/                   # é¦–æ¬¡è¿è¡Œæ—¶ä¸‹è½½
            â”œâ”€â”€ medium.pt
            â””â”€â”€ large-v2.pt
```

#### 5.2.2 Electron æ‰“åŒ…é…ç½®

**package.json è„šæœ¬**ï¼š

```json
{
  "scripts": {
    "start": "electron-forge start",
    "package": "electron-forge package",
    "make": "electron-forge make",
    "package:python": "cd python-engine && python build.py"
  },
  "config": {
    "forge": {
      "packagerConfig": {
        "icon": "./build/icon",
        "extraResource": [
          "./dist/python-engine"
        ]
      },
      "makers": [
        {
          "name": "@electron-forge/maker-squirrel",
          "config": {
            "name": "QuickTrans",
            "setupIcon": "./build/icon.ico"
          }
        },
        {
          "name": "@electron-forge/maker-zip",
          "platforms": ["darwin", "linux"]
        }
      ]
    }
  }
}
```

#### 5.2.3 æ¨¡å‹æ–‡ä»¶åˆ†å‘ç­–ç•¥

**æ··åˆæ–¹æ¡ˆ**ï¼šåŸºç¡€åŒ… + é¦–æ¬¡ä¸‹è½½

```typescript
// src/main/model-downloader.ts
import { download } from 'electron-dl';

export class ModelDownloader {
  private readonly MODELS = {
    medium: {
      url: 'https://huggingface.co/guillaumekln/faster-whisper-medium/resolve/main/model.bin?',
      size: '1.5GB',
      checksum: 'sha256:abc123...'
    },
    'large-v2': {
      url: 'https://huggingface.co/guillaumekln/faster-whisper-large-v2/resolve/main/model.bin?',
      size: '3GB',
      checksum: 'sha256:def456...'
    }
  };

  async ensureModel(modelSize: string): Promise<string> {
    const modelPath = path.join(app.getPath('userData'), 'models', modelSize);

    if (fs.existsSync(modelPath)) {
      return modelPath;
    }

    // é¦–æ¬¡ä½¿ç”¨ï¼Œæ˜¾ç¤ºä¸‹è½½è¿›åº¦
    await this.downloadWithProgress(modelSize, modelPath);
    return modelPath;
  }

  private async downloadWithProgress(modelSize: string, targetPath: string) {
    const win = BrowserWindow.getAllWindows()[0];
    const model = this.MODELS[modelSize];

    await download(win, model.url, {
      directory: path.dirname(targetPath),
      onProgress: (progress) => {
        win.setProgressBar(progress.percent);
        win.webContents.send('model-download:progress', progress);
      }
    });
  }
}
```

#### 5.2.4 æœ€ç»ˆä½“ç§¯ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | å‡å°‘ä½“ç§¯ | æ–¹æ¡ˆ |
|--------|----------|------|
| FFmpeg | -200MB | ä»…ç¼–è¯‘å¿…éœ€ç¼–è§£ç å™¨ |
| Python è¿è¡Œæ—¶ | -150MB | ä½¿ç”¨ PyInstaller çš„ --exclude-module |
| Torch åº“ | -500MB | ä½¿ç”¨ Faster-Whisper çš„ int8 é‡åŒ–ç‰ˆæœ¬ |
| æ¨¡å‹æ–‡ä»¶ | -3GB | é‡‡ç”¨é¦–æ¬¡ä¸‹è½½ç­–ç•¥ |
| **æœ€ç»ˆä½“ç§¯** | **~800MB** | å¯æ¥å—èŒƒå›´å†… |

### 5.3 è‡ªåŠ¨æ›´æ–°æ–¹æ¡ˆ

**ä½¿ç”¨ electron-updater**ï¼š

```typescript
import { autoUpdater } from 'electron-updater';

export function setupAutoUpdater() {
  autoUpdater.setFeedURL({
    provider: 'github',
    owner: 'your-org',
    repo: 'quicktrans'
  });

  autoUpdater.on('update-available', () => {
    // é€šçŸ¥ç”¨æˆ·
  });

  autoUpdater.on('update-downloaded', () => {
    // æç¤ºé‡å¯å®‰è£…
  });

  // æ¯æ¬¡å¯åŠ¨æ£€æŸ¥æ›´æ–°
  autoUpdater.checkForUpdatesAndNotify();
}
```

---

## 6. æ ¸å¿ƒä»£ç æ¡†æ¶å®ç°æ–¹æ¡ˆ

### 6.1 é¡¹ç›®åˆå§‹åŒ–

**ç›®å½•ç»“æ„**ï¼š

```
QuickTrans/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/                    # Electron ä¸»è¿›ç¨‹
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ python-bridge.ts
â”‚   â”‚   â”œâ”€â”€ task-scheduler.ts
â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â””â”€â”€ ipc-handlers.ts
â”‚   â”œâ”€â”€ renderer/                # React å‰ç«¯
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileDropZone.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultView.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ExportPanel.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useTranscription.ts
â”‚   â”‚   â”‚   â””â”€â”€ useTasks.ts
â”‚   â”‚   â””â”€â”€ store.ts
â”‚   â””â”€â”€ shared/                  # å…±äº«ç±»å‹
â”‚       â””â”€â”€ types.ts
â”œâ”€â”€ python-engine/               # Python AI å¼•æ“
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ build/                       # æ„å»ºèµ„æº
â”‚   â””â”€â”€ icon.ico
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

**åˆå§‹åŒ–å‘½ä»¤**ï¼š

```bash
# 1. åˆ›å»º Electron + React é¡¹ç›®
npm create vite@latest src/renderer -- --template react-ts
npm install --save-dev electron electron-forge

# 2. å®‰è£…å‰ç«¯ä¾èµ–
npm install @tanstack/react-query zustand lucide-react clsx tailwind-merge

# 3. å®‰è£…ä¸»è¿›ç¨‹ä¾èµ–
npm install better-sqlite3 node-pty electron-dl electron-better-ipc

# 4. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
cd python-engine
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install fastapi uvicorn faster-whisper torch
```

### 6.2 å…³é”®ç»„ä»¶å®ç°

#### 6.2.1 æ–‡ä»¶æ‹–æ‹½ç»„ä»¶

```typescript
// src/renderer/components/FileDropZone.tsx
import { useCallback, useState } from 'react';
import { ipcRenderer } from 'electron';

export function FileDropZone() {
  const [isDragging, setIsDragging] = useState(false);
  const [selectedFile, setSelectedFile] = useState<string | null>(null);

  const handleDrop = useCallback((e: DragEvent) => {
    e.preventDefault();
    setIsDragging(false);

    const files = Array.from(e.dataTransfer?.files || []);
    if (files.length > 0) {
      const file = files[0];
      setSelectedFile(file.path);
    }
  }, []);

  const handleStartTranscription = async () => {
    if (!selectedFile) return;

    const result = await ipcRenderer.invoke('transcribe:start', {
      filePath: selectedFile,
      sourceLang: 'auto',
      targetLang: 'zh'
    });

    // è¿”å›ä»»åŠ¡ IDï¼Œç”¨äºè¿›åº¦è¿½è¸ª
    return result.taskId;
  };

  return (
    <div
      onDrop={handleDrop}
      onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
      onDragLeave={() => setIsDragging(false)}
      className={`
        border-2 border-dashed rounded-lg p-12 text-center transition-colors
        ${isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300'}
      `}
    >
      <Upload className="w-16 h-16 mx-auto mb-4 text-gray-400" />
      <p className="text-lg font-medium text-gray-700">
        æ‹–æ‹½éŸ³é¢‘/è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„
      </p>
      <p className="text-sm text-gray-500 mt-2">
        æ”¯æŒ MP3, WAV, M4A, MP4, MKV ç­‰æ ¼å¼
      </p>

      {selectedFile && (
        <div className="mt-6">
          <p className="text-sm text-gray-600 mb-4">{selectedFile}</p>
          <button
            onClick={handleStartTranscription}
            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            å¼€å§‹ç¿»è¯‘
          </button>
        </div>
      )}
    </div>
  );
}
```

#### 6.2.2 ç¿»è¯‘ç»“æœå±•ç¤º

```typescript
// src/renderer/components/ResultView.tsx
import { useState, useEffect } from 'react';

interface Segment {
  start: number;
  end: number;
  text: string;
  translation: string;
}

export function ResultView({ taskId }: { taskId: string }) {
  const [segments, setSegments] = useState<Segment[]>([]);
  const [currentTime, setCurrentTime] = useState(0);

  useEffect(() => {
    // ä»æ•°æ®åº“æˆ– API è·å–ç»“æœ
    ipcRenderer.invoke('tasks:get', taskId).then(task => {
      setSegments(task.result.segments);
    });
  }, [taskId]);

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  return (
    <div className="space-y-2">
      {segments.map((seg, idx) => (
        <div
          key={idx}
          className="p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow"
        >
          <div className="flex items-center gap-4 mb-2">
            <span className="text-sm font-mono text-gray-500">
              {formatTime(seg.start)}
            </span>
            <div className="flex-1">
              <p className="text-gray-800">{seg.text}</p>
              <p className="text-blue-600 mt-1">{seg.translation}</p>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
}
```

#### 6.2.3 SRT å¯¼å‡ºåŠŸèƒ½

```typescript
// src/renderer/components/ExportPanel.tsx
import { ipcRenderer } from 'electron';
import { Download } from 'lucide-react';

export function ExportPanel({ taskId }: { taskId: string }) {
  const handleExport = async (format: 'srt' | 'txt') => {
    const { filePath } = await ipcRenderer.invoke('dialog:save', {
      defaultPath: `output.${format}`,
      filters: [{ name: format.toUpperCase(), extensions: [format] }]
    });

    if (filePath) {
      await ipcRenderer.invoke('export:file', {
        taskId,
        format,
        savePath: filePath
      });
    }
  };

  return (
    <div className="flex gap-4">
      <button
        onClick={() => handleExport('srt')}
        className="flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900"
      >
        <Download className="w-4 h-4" />
        å¯¼å‡º SRT
      </button>
      <button
        onClick={() => handleExport('txt')}
        className="flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900"
      >
        <Download className="w-4 h-4" />
        å¯¼å‡º TXT
      </button>
    </div>
  );
}
```

### 6.3 ä¸»è¿›ç¨‹å…¥å£

```typescript
// src/main/index.ts
import { app, BrowserWindow } from 'electron';
import { PythonBridge } from './python-bridge';
import { TaskDatabase } from './database';
import { registerIPCHandlers } from './ipc-handlers';

let mainWindow: BrowserWindow;
let pythonBridge: PythonBridge;
let database: TaskDatabase;

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    }
  });

  if (process.env.NODE_ENV === 'development') {
    mainWindow.loadURL('http://localhost:5173');
    mainWindow.webContents.openDevTools();
  } else {
    mainWindow.loadFile(path.join(__dirname, '../renderer/index.html'));
  }
}

app.whenReady().then(async () => {
  database = new TaskDatabase();
  pythonBridge = new PythonBridge();
  await pythonBridge.start();

  createWindow();
  registerIPCHandlers(database);
});

app.on('window-all-closed', () => {
  pythonBridge.stop();
  database.close();
  if (process.platform !== 'darwin') app.quit();
});
```

---

## 7. æ‰©å±•æ€§è®¾è®¡

### 7.1 æœªæ¥åŠŸèƒ½æ¥å…¥ç‚¹

| åŠŸèƒ½æ¨¡å— | æ¥å…¥æ–¹å¼ | å®ç°éš¾åº¦ |
|----------|----------|----------|
| **TTS è¯­éŸ³åˆæˆ** | æ–°å¢ PyTorch æ¨¡å‹ï¼Œç‹¬ç«‹ API ç«¯ç‚¹ | ä¸­ç­‰ |
| **å¤šè¯­ç§æ”¯æŒ** | Whisper æœ¬èº«æ”¯æŒ 99 è¯­ç§ï¼Œä»…éœ€å‰ç«¯æ·»åŠ é€‰æ‹©å™¨ | ç®€å• |
| **å®æ—¶å­—å¹•** | æ”¹ç”¨ Streaming æ¨¡å¼ï¼ŒPyAudio å®æ—¶æ•è· | å¤æ‚ |
| **è¯´è¯äººè¯†åˆ«** | é›†æˆ pyannote.audioï¼Œæ·»åŠ  diarization ç«¯ç‚¹ | ä¸­ç­‰ |
| **AI è¯‘åç¼–è¾‘** | æ¥å…¥ LLM APIï¼ˆå¦‚æœ¬åœ° Llamaï¼‰ï¼Œå¢åŠ æ¶¦è‰²æ­¥éª¤ | ä¸­ç­‰ |

### 7.2 æ’ä»¶åŒ–æ¶æ„

```python
# python-engine/plugins/base.py
from abc import ABC, abstractmethod

class Plugin(ABC):
    @abstractmethod
    def on_transcribe_start(self, context: dict):
        pass

    @abstractmethod
    def on_transcribe_complete(self, context: dict, segments: list):
        pass

# ç¤ºä¾‹æ’ä»¶ï¼šæ•æ„Ÿè¯è¿‡æ»¤
class ProfanityFilterPlugin(Plugin):
    def on_transcribe_complete(self, context, segments):
        # è¿‡æ»¤æ•æ„Ÿè¯å¹¶æ›¿æ¢
        return [self._filter(seg) for seg in segments]
```

---

## 8. å¼€å‘è·¯çº¿å›¾

### Phase 1: MVPï¼ˆ4 å‘¨ï¼‰
- [ ] åŸºç¡€ UI æ­å»º
- [ ] Python + Electron é€šä¿¡æ‰“é€š
- [ ] Whisper æ¨ç†æµç¨‹
- [ ] SRT å¯¼å‡ºåŠŸèƒ½

### Phase 2: ä¼˜åŒ–ï¼ˆ3 å‘¨ï¼‰
- [ ] è¿›åº¦æ¡å®æ—¶åé¦ˆ
- [ ] æ•°æ®åº“å†å²è®°å½•
- [ ] é”™è¯¯å¤„ç†ä¸é‡è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆGPU åŠ é€Ÿï¼‰

### Phase 3: æ‰“åŒ…ï¼ˆ2 å‘¨ï¼‰
- [ ] PyInstaller æ‰“åŒ…æµ‹è¯•
- [ ] Electron-forge é…ç½®
- [ ] æ¨¡å‹æ–‡ä»¶ä¸‹è½½æœºåˆ¶
- [ ] å®‰è£…åŒ…åˆ¶ä½œ

### Phase 4: å‘å¸ƒï¼ˆ1 å‘¨ï¼‰
- [ ] åº”ç”¨ç­¾åï¼ˆWindows/macOSï¼‰
- [ ] è‡ªåŠ¨æ›´æ–°é…ç½®
- [ ] å®˜ç½‘ + æ–‡æ¡£
- [ ] åˆç‰ˆå‘å¸ƒ

---

## 9. è®¸å¯åè®®

MIT License Â· å•†ä¸šåŒ–éœ€ä¿ç•™ç‰ˆæƒå£°æ˜

---

## é™„å½•ï¼šå¿«é€Ÿå¯åŠ¨æŒ‡å—

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/QuickTrans.git
cd QuickTrans

# å®‰è£…ä¾èµ–
npm install
cd python-engine && python -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run dev

# æ‰“åŒ…ç”Ÿäº§ç‰ˆæœ¬
npm run make
```

**æŠ€æœ¯æ”¯æŒ**ï¼šsupport@quicktrans.io
**GitHub Issues**ï¼šhttps://github.com/your-org/QuickTrans/issues
